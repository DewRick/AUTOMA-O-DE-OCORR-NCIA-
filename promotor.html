<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Relatório</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f4f4f4;padding:20px}
button{padding:6px 12px;border:0;border-radius:6px;cursor:pointer}
.categoria{background:#fff;margin-bottom:10px;border-radius:8px;padding:10px}
.categoria h3{margin:0;cursor:pointer}
.produtos{display:none;margin-top:8px}
.produto{display:flex;justify-content:space-between;font-size:14px;padding:2px 0;cursor:pointer}
textarea{width:100%;height:220px;margin-top:20px}
.topo{display:flex;justify-content:space-between;align-items:center}
</style>
</head>
<body>

<div class="topo">
<button onclick="voltar()">⬅ Voltar</button>
<h3 id="titulo"></h3>
<div></div>
</div>

<div id="listaCategorias"></div>

<textarea id="saida" readonly></textarea>
<button onclick="copiar()">Copiar</button>

<script src="promotores.js"></script>
<script src="produtos.js"></script>
<script>
const promotor=localStorage.getItem("promotor");
if(!promotor) location.href="index.html";
document.getElementById("titulo").textContent=promotor;

const estado={}; // produto -> ocorrencia

const cont=document.getElementById("listaCategorias");

Object.entries(produtos).forEach(([cat,grupos])=>{
  const box=document.createElement("div");
  box.className="categoria";
  const h=document.createElement("h3");
  h.textContent=cat;
  const lista=document.createElement("div");
  lista.className="produtos";

  h.onclick=()=>lista.style.display=lista.style.display==="none"?"block":"none";

  Object.entries(grupos).forEach(([peso,itens])=>{
    itens.forEach(p=>{
      const d=document.createElement("div");
      d.className="produto";
      d.innerHTML=`<span>${p}</span><span></span>`;
      d.onclick=()=>{
        estado[p]=estado[p]==="Baixo Volume"?"Ruptura":estado[p]==="Ruptura"?null:"Baixo Volume";
        d.lastChild.textContent=estado[p]||"";
        gerar();
      };
      lista.appendChild(d);
    });
  });

  box.appendChild(h);
  box.appendChild(lista);
  cont.appendChild(box);
});

function gerar(){
  let bv=[],rp=[];
  Object.entries(estado).forEach(([p,o])=>{
    if(o==="Baixo Volume") bv.push(p);
    if(o==="Ruptura") rp.push(p);
  });

  let txt="";
  if(bv.length) txt+="BAIXO VOLUME\n"+bv.join(", ")+"\n\n";
  if(rp.length) txt+="RUPTURA\n"+rp.join(", ");
  document.getElementById("saida").value=txt;
}

function copiar(){
  navigator.clipboard.writeText(saida.value);
}

function voltar(){location.href="index.html";}
</script>
</body>
</html>

