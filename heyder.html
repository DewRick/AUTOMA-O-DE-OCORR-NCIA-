<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Automação de Ocorrência</title>

<style>
body{font-family:Arial,sans-serif;background:#e0f7fa}
.container{width:380px;margin:20px auto;background:#fff;padding:20px;border-radius:10px}
h2,h3{text-align:center}
.section{margin-top:20px}
.category{border:1px solid #ccc;border-radius:6px;margin-bottom:10px}
.category-header{background:#f2f2f2;padding:8px;cursor:pointer;font-weight:bold}
.category-content{display:none;padding:10px}
table{width:100%;border-collapse:collapse;font-size:12px}
th,td{border-bottom:1px solid #ddd;padding:4px;text-align:center}
th:first-child,td:first-child{text-align:left}
textarea{width:100%;height:240px;margin-top:10px}
button{margin-top:10px;width:100%;padding:8px;font-weight:bold}
.hidden{display:none}
select{width:100%;padding:6px}
</style>
</head>

<body>
<div class="container">
<h2>AUTOMAÇÃO DE OCORRÊNCIA</h2>

<div class="section">
<h3>Promotor</h3>
<select id="promotor">
<option value="">Selecione</option>
<option value="Rickson">Rickson</option>
<option value="Outro">Outro</option>
</select>
</div>

<div class="section hidden" id="blocoLojas">
<h3>Lojas</h3>
<div id="lojas"></div>
</div>

<div class="section hidden" id="blocoProdutos">
<h3>Produtos</h3>
<div id="produtos"></div>
</div>

<div class="section">
<h3>COMUNICAÇÃO</h3>
<textarea id="saida" readonly></textarea>
<button onclick="copiar()">Copiar texto</button>
</div>
</div>

<script>
/* ===== DADOS ===== */
const lojas=[
"Atacadão Resende",
"Dom Atacadista Resende",
"163-Havan-Resende",
"1197-Lasa-Barra Mansa",
"230-Lasa-SHC Resende"
];

const catalogo={
"SM 80g":["Dentadura 80g","Beijos Morango 80g","Banana 80g"],
"SM 15g":["Dentadura 15g","Beijos Morango 15g"],
"TUBES 80g":["Morango Cítrico 80g","Twister 80g"],
"MASH 80g":["Torção Recheado 80g","Flor 80g"]
};

/* ===== RENDER LOJAS ===== */
const lojasDiv=document.getElementById('lojas');
lojas.forEach(l=>{
lojasDiv.innerHTML+=`<label><input type="checkbox" class="loja" value="${l}"> ${l}</label><br>`;
});

/* ===== RENDER PRODUTOS ===== */
const produtosDiv=document.getElementById('produtos');
Object.entries(catalogo).forEach(([categoria,itens])=>{
const id=categoria.replace(/\s+/g,'_');
let html=`<div class="category">
<div class="category-header" onclick="toggle('${id}')">${categoria}</div>
<div class="category-content" id="${id}">
<table>
<tr><th>Produto</th><th>Baixo Volume</th><th>Ruptura</th></tr>`;
itens.forEach(p=>{
html+=`<tr>
<td>${p}</td>
<td><input type="radio" name="${p}" data-cat="${categoria}" data-oc="Baixo Volume" data-prod="${p}"></td>
<td><input type="radio" name="${p}" data-cat="${categoria}" data-oc="Ruptura" data-prod="${p}"></td>
</tr>`;
});
html+=`</table></div></div>`;
produtosDiv.innerHTML+=html;
});

/* ===== CONTROLES ===== */
function toggle(id){
const el=document.getElementById(id);
el.style.display=el.style.display==='block'?'none':'block';
}

document.getElementById('promotor').addEventListener('change',()=>{
const ativo=promotor.value!=="";
document.getElementById('blocoLojas').classList.toggle('hidden',!ativo);
document.getElementById('blocoProdutos').classList.toggle('hidden',!ativo);
atualizar();
});

document.addEventListener('change',atualizar);

/* ===== TEXTO FINAL ===== */
const saida=document.getElementById('saida');
function atualizar(){
let txt='COMUNICAÇÃO DE OCORRÊNCIA\n\n';

const prom=document.getElementById('promotor').value;
if(prom) txt+='PROMOTOR: '+prom+'\n';

const lojasSel=[...document.querySelectorAll('.loja:checked')].map(l=>l.value);
if(lojasSel.length) txt+='LOJA: '+lojasSel.join(', ')+'\n\n';

['Baixo Volume','Ruptura'].forEach(tipo=>{
const selecionados=[...document.querySelectorAll(`[data-oc="${tipo}"]:checked`)];
if(!selecionados.length) return;

txt+=`• OCORRÊNCIA DE ${tipo}\n\n`;

const porCategoria={};
selecionados.forEach(cb=>{
const cat=cb.dataset.cat;
if(!porCategoria[cat]) porCategoria[cat]=[];
porCategoria[cat].push(cb.dataset.prod);
});

Object.entries(porCategoria).forEach(([cat,prods])=>{
txt+=cat+'\n';
prods.forEach(p=>txt+=`- ${p}\n`);
});
txt+='\n';
});

saida.value=txt.trim();
}

function copiar(){
saida.select();
document.execCommand('copy');
}
</script>
</body>
</html>
